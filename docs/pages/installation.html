<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation and Dependencies &mdash; NekDCTB 0.1 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="List of core codes." href="list_of_codes.html" />
    <link rel="prev" title="NekDCTB" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> NekDCTB
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation and Dependencies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-and-usage">Installation and Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#linking-nek5000-with-adios2">Linking Nek5000 with ADIOS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiling-nek5000-with-adios2">Compiling Nek5000 with ADIOS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-nek5000-with-adios2">Running Nek5000 with ADIOS2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="list_of_codes.html">List of core codes.</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Theoretical Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="casename_par.html">&lt;casename&gt;.par</a></li>
<li class="toctree-l1"><a class="reference internal" href="casename_usr.html">&lt;casename&gt;.usr</a></li>
<li class="toctree-l1"><a class="reference internal" href="compile_script.html">compile_script</a></li>
<li class="toctree-l1"><a class="reference internal" href="makefile_usr_inc.html">makefile_usr.inc</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NekDCTB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Installation and Dependencies</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="installation-and-dependencies">
<h1>Installation and Dependencies<a class="headerlink" href="#installation-and-dependencies" title="Permalink to this headline">¶</a></h1>
<!---
## Note
This toolbox is self-contained, therefore the solver Nek5000 and needed libraries as ADIOS2 are shipped in this repository. We note that the procedure to use the toolbox is more involved that simply activating a runtime parameter. This is done to take into consideration the Nek5000 philosophy of modifing the source as little as possible and running user specified functions from a so called ```user file```. In the course of these instructions we will specify what commands need to be added to this file for everything to run smoothly. We expect that any Nek5000 user will be able to follow these instructions without much consideration. If dificulties arise, do not doubt to contact us.
--><div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>The following dependencies are required for Nek5000</li>
</ol>
<ul class="simple">
<li>FORTRAN 77 compilers</li>
<li>C and C++ compilers</li>
<li>MPI</li>
</ul>
<ol class="arabic simple" start="2">
<li>The following dependencies are required for ADIOS2</li>
</ol>
<ul class="simple">
<li>CMake</li>
</ul>
<p>In a super computer such as
<a class="reference external" href="https://www.pdc.kth.se/hpc-services/computing-systems/about-dardel-1.1053338">Dardel</a>
at PDC in Stockholm, loading the following modules is enough for
compilation and execution:</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">swap</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">cray</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">gnu</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">PDC</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">CMake</span><span class="o">/</span><span class="mf">3.21.2</span>
<span class="n">module</span> <span class="n">swap</span> <span class="n">craype</span><span class="o">-</span><span class="n">network</span><span class="o">-</span><span class="n">ofi</span> <span class="n">craype</span><span class="o">-</span><span class="n">network</span><span class="o">-</span><span class="n">ucx</span>
<span class="n">module</span> <span class="n">swap</span> <span class="n">cray</span><span class="o">-</span><span class="n">mpich</span> <span class="n">cray</span><span class="o">-</span><span class="n">ucx</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">mpich</span><span class="o">-</span><span class="n">ucx</span>
</pre></div>
</div>
</div>
<div class="section" id="installation-and-usage">
<h2>Installation and Usage<a class="headerlink" href="#installation-and-usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="linking-nek5000-with-adios2">
<h3>Linking Nek5000 with ADIOS2<a class="headerlink" href="#linking-nek5000-with-adios2" title="Permalink to this headline">¶</a></h3>
<p>In this repository we include a
<a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/tree/main/Nek5000">Nek5000</a>
version that has been modified for linking with the ADIOS2 library. For
the sake of convenience, we have included a tested version of ADIOS2
under the
<a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/tree/main/Nek5000/3rd_party/adios2">/Nek5000/3rd_party/adios2</a>
that can be easily installed by executing the <code class="docutils literal notranslate"><span class="pre">install.sh</span></code> script in
the folder or at Nek5000 compile time (see sections below). If a user
wish to use their own version of Nek5000, some files in the source need
to be modified for the linking to occur. Such files can be readily
checked and copied from the Nek5000 version shipped in this repository.</p>
<p>The following files were modified in the <a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/tree/main/Nek5000/core">core</a>:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/Nek5000/core/drive.f">drive.f</a></li>
<li><a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/Nek5000/core/makenek.inc">makenek.inc</a></li>
<li><a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/Nek5000/core/makefile.template">makefile.template</a></li>
</ul>
<p>The following files were added to the <a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/tree/main/Nek5000/core/3rd_party">3rd_party</a>
folder and contain the ADIOS2 subroutines.</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/Nek5000/core/3rd_party/nek_in_situ.f">nek_in_situ.f</a></li>
<li><a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/Nek5000/core/3rd_party/adios2.f">adios2.f</a></li>
<li><a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/Nek5000/core/3rd_party/nek_adios2.cpp">nek_adios2.cpp</a></li>
</ul>
</div>
<div class="section" id="compiling-nek5000-with-adios2">
<h3>Compiling Nek5000 with ADIOS2<a class="headerlink" href="#compiling-nek5000-with-adios2" title="Permalink to this headline">¶</a></h3>
<!---
Nek5000 is a FORTRAN77 solver that must be compiled for each case to be run, therefore the tools must be compiled as well. The third party libraries, like ADIOS2, do not need to be compiled everytime changes happen in the code, therefore we recomend that this is done only once.
---><p>Just as for any other used-defined function in Nek5000, 3 main files
must be modified to be able to use the toolbox:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="compile_script.html#compile-script"><span class="std std-ref">compile_script</span></a></li>
<li><a class="reference internal" href="makefile_usr_inc.html#makefile-usr-inc"><span class="std std-ref">makefile_usr.inc</span></a></li>
<li><a class="reference internal" href="casename_usr.html#casename-usr"><span class="std std-ref">&lt;casename&gt;.usr</span></a></li>
</ol>
<p>Templates of the modified files can be found at the
<a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/tree/main/DCTB">DCTB</a> and
<a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/examples/turbPipe/compile/">examples</a>
folders, however, a list of modifications to the files can be found by
using the hyperlinks.</p>
<p>Having modified all the files accordingly, compilation follows by
ensuring that the <code class="docutils literal notranslate"><span class="pre">SIZE</span></code> file is present in the folder and executing
the command:</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">compile_script</span> <span class="o">--</span><span class="nb">all</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">ADIOS2</span></code> has not been compiled, the following message will prompt
and ADIOS2 will be compiled:</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compression</span> <span class="n">requires</span> <span class="n">ADIOS2</span> <span class="n">to</span> <span class="n">be</span> <span class="n">build</span> <span class="n">before</span> <span class="n">compilation</span> <span class="n">of</span> <span class="n">Nek5000</span>
<span class="n">Turning</span> <span class="n">to</span> <span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">dep</span> <span class="n">mode</span>
<span class="n">building</span> <span class="mi">3</span><span class="n">rd</span><span class="o">-</span><span class="n">party</span> <span class="n">dependencies</span>
</pre></div>
</div>
<p>In this case, after the compilation of <code class="docutils literal notranslate"><span class="pre">ADIOS2</span></code>, Nek5000 will not
automatically restart the compilation of the case, therefore after all
the 3rd party libraries have been compiled, the user must run
<code class="docutils literal notranslate"><span class="pre">./compile_script</span> <span class="pre">--all</span></code> once again to compile the case. If the
process is succesful, the executable <code class="docutils literal notranslate"><span class="pre">Nek5000</span></code> and the folder
<code class="docutils literal notranslate"><span class="pre">config</span></code> will be added to the <code class="docutils literal notranslate"><span class="pre">compile</span></code> sub-directory.</p>
</div>
<div class="section" id="running-nek5000-with-adios2">
<h3>Running Nek5000 with ADIOS2<a class="headerlink" href="#running-nek5000-with-adios2" title="Permalink to this headline">¶</a></h3>
<p>Prior to running, the behaviour of the compression toolbox can be
modified by changing the runtime parameters that need to be included in
the <code class="docutils literal notranslate"><span class="pre">&lt;casename&gt;.par</span></code> file. A template of the of the aditions to this
file can be found in the
<a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/tree/main/DCTB">DCTB</a> and
<a class="reference external" href="https://github.com/KTH-Nek5000/NekDCTB/blob/main/examples/turbPipe/compile/">examples</a>
folder and a description of each parameter can be found following <a class="reference internal" href="casename_par.html#casename-par"><span class="std std-ref">&lt;casename&gt;.par</span></a></p>
<p>To run Nek5000 it is necesary that the <code class="docutils literal notranslate"><span class="pre">Nek5000</span></code> executable and the
<code class="docutils literal notranslate"><span class="pre">config</span></code> folder are copied from the compilation folder to the run
folder. Executing Nek5000 with the data compression toolbox enabled is
as simple as executing, for example:</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="o">./</span><span class="n">nek5000</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="NekDCTB" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="list_of_codes.html" class="btn btn-neutral float-right" title="List of core codes." accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, KTH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>